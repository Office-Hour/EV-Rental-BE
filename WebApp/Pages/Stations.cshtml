@page
@model WebApp.Pages.StationsModel
@{
    ViewData["Title"] = "Trạm Xe Điện";
}

<link rel="stylesheet" href="~/css/Index.css" />
<link rel="stylesheet" href="~/css/stations.css" asp-append-version="true" />

<!-- Hero Section -->
<section class="hero-section hero-gradient">
    <div class="container" style="max-width: 72rem;">
        <div class="text-center hero-content">
            <!-- Title -->
            <h1 class="fw-bold text-white lh-tight mb-3 display-5 display-md-3">
                Trạm Xe Điện
                <span class="d-block gradient-text">Voltera</span>
            </h1>

            <!-- Subtitle -->
            <p class="fs-5 text-slate-300 mx-auto mb-5" style="max-width: 48rem;">
                Tìm trạm xe điện gần bạn với hệ thống trải rộng khắp cả nước
            </p>


            <!-- Search Form -->
            <form method="get" class="search-form mx-auto">
                <div class="row g-3">
                    <div class="col-md-5">
                        <div class="search-input-group">
                            <span class="material-icons search-icon">location_city</span>
                            <input type="text" 
                                   name="SearchName" 
                                   value="@Model.SearchName" 
                                   class="form-control search-input" 
                                   placeholder="Tên trạm..." />
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="search-input-group">
                            <span class="material-icons search-icon">location_on</span>
                            <input type="text" 
                                   name="SearchAddress" 
                                   value="@Model.SearchAddress" 
                                   class="form-control search-input" 
                                   placeholder="Địa chỉ..." />
                        </div>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-gradient btn-search w-100">
                            <span class="material-icons">search</span>
                            Tìm
                        </button>
                    </div>
                </div>
            </form>

            @if (!string.IsNullOrWhiteSpace(Model.SearchName) || !string.IsNullOrWhiteSpace(Model.SearchAddress))
            {
                <div class="mt-3">
                    <a asp-page="/Stations" class="btn btn-outline-slate btn-sm">
                        <span class="material-icons" style="font-size: 1rem;">clear</span>
                        Xóa Bộ Lọc
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<!-- Stations Grid Section -->
<section class="py-5 bg-slate-50">
    <div class="container" style="max-width: 72rem;">
        @if (Model.Stations?.Items?.Any() == true)
        {
            <!-- Results Header -->
            <div class="results-header mb-4">
                <h2 class="fw-bold text-slate-800 mb-2">
                    Tìm thấy @Model.Stations.Total trạm
                </h2>
                <p class="text-slate-600">
                    Trang @Model.Stations.Page / @Math.Ceiling((double)Model.Stations.Total / Model.Stations.PageSize)
                </p>
            </div>

            <!-- Stations Grid -->
            <div class="row g-4 mb-5">
                @foreach (var station in Model.Stations.Items)
                {
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="station-card">
                            <div class="station-card-header">
                                <div class="station-icon">
                                    <span class="material-icons">ev_station</span>
                                </div>
                                <div class="station-capacity">
                                    <span class="material-icons">electric_car</span>
                                    <span>@station.Capacity</span>
                                </div>
                            </div>

                            <div class="station-card-body">
                                <h3 class="station-name">@station.Name</h3>
                                <p class="station-address">
                                    <span class="material-icons">location_on</span>
                                    @station.Address
                                </p>

                                @if (station.Latitude.HasValue && station.Longitude.HasValue)
                                {
                                    <div class="station-coordinates">
                                        <span class="material-icons">my_location</span>
                                        <small>@station.Latitude.Value.ToString("F6"), @station.Longitude.Value.ToString("F6")</small>
                                    </div>
                                }
                            </div>

                            <div class="station-card-footer">
                                <a href="https://www.google.com/maps/search/?api=1&query=@station.Latitude,@station.Longitude" 
                                   target="_blank" 
                                   class="btn btn-outline-primary btn-sm">
                                    <span class="material-icons">directions</span>
                                    Chỉ đường
                                </a>
                                <a asp-page="/Station"
                                   asp-route-id="@station.Id"
                                   class="btn btn-primary btn-sm">
                                    <span class="material-icons">electric_car</span>
                                    Xem Xe
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            @if (Model.Stations.Total > Model.PageSize)
            {
                <nav aria-label="Station pagination">
                    <ul class="pagination justify-content-center">
                        <!-- Previous Button -->
                        <li class="page-item @(Model.PageNumber <= 1 ? "disabled" : "")">
                            <a class="page-link" 
                               asp-page="/Stations" 
                               asp-route-pageNumber="@(Model.PageNumber - 1)"
                               asp-route-pageSize="@Model.PageSize"
                               asp-route-searchName="@Model.SearchName"
                               asp-route-searchAddress="@Model.SearchAddress">
                                <span class="material-icons">chevron_left</span>
                            </a>
                        </li>

                        @{
                            var totalPages = (int)Math.Ceiling((double)Model.Stations.Total / Model.PageSize);
                            var startPage = Math.Max(1, Model.PageNumber - 2);
                            var endPage = Math.Min(totalPages, Model.PageNumber + 2);
                        }

                        @if (startPage > 1)
                        {
                            <li class="page-item">
                                <a class="page-link" 
                                   asp-page="/Stations" 
                                   asp-route-pageNumber="1"
                                   asp-route-pageSize="@Model.PageSize"
                                   asp-route-searchName="@Model.SearchName"
                                   asp-route-searchAddress="@Model.SearchAddress">
                                    1
                                </a>
                            </li>
                            @if (startPage > 2)
                            {
                                <li class="page-item disabled">
                                    <span class="page-link">...</span>
                                </li>
                            }
                        }

                        @for (var i = startPage; i <= endPage; i++)
                        {
                            <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                                <a class="page-link" 
                                   asp-page="/Stations" 
                                   asp-route-pageNumber="@i"
                                   asp-route-pageSize="@Model.PageSize"
                                   asp-route-searchName="@Model.SearchName"
                                   asp-route-searchAddress="@Model.SearchAddress">
                                    @i
                                </a>
                            </li>
                        }

                        @if (endPage < totalPages)
                        {
                            @if (endPage < totalPages - 1)
                            {
                                <li class="page-item disabled">
                                    <span class="page-link">...</span>
                                </li>
                            }
                            <li class="page-item">
                                <a class="page-link" 
                                   asp-page="/Stations" 
                                   asp-route-pageNumber="@totalPages"
                                   asp-route-pageSize="@Model.PageSize"
                                   asp-route-searchName="@Model.SearchName"
                                   asp-route-searchAddress="@Model.SearchAddress">
                                    @totalPages
                                </a>
                            </li>
                        }

                        <!-- Next Button -->
                        <li class="page-item @(Model.PageNumber >= totalPages ? "disabled" : "")">
                            <a class="page-link" 
                               asp-page="/Stations" 
                               asp-route-pageNumber="@(Model.PageNumber + 1)"
                               asp-route-pageSize="@Model.PageSize"
                               asp-route-searchName="@Model.SearchName"
                               asp-route-searchAddress="@Model.SearchAddress">
                                <span class="material-icons">chevron_right</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            }
        }
        else
        {
            <!-- Empty State -->
            <div class="empty-state-section">
                <div class="empty-state-icon">
                    <span class="material-icons">search_off</span>
                </div>
                <h3 class="empty-state-title">Không tìm thấy trạm nào</h3>
                <p class="empty-state-description">
                    @if (!string.IsNullOrWhiteSpace(Model.SearchName) || !string.IsNullOrWhiteSpace(Model.SearchAddress))
                    {
                        <span>Vui lòng thử lại vài từ khóa khác</span>
                    }
                    else
                    {
                        <span>Hiện tại chưa có trạm nào trong hệ thống.</span>
                    }
                </p>
                @if (!string.IsNullOrWhiteSpace(Model.SearchName) || !string.IsNullOrWhiteSpace(Model.SearchAddress))
                {
                    <a asp-page="/Stations" class="btn btn-gradient mt-3">
                        <span class="material-icons">refresh</span>
                        Xem Tất Cả Trạm
                    </a>
                }
            </div>
        }
    </div>
</section>

<!-- Features Section -->
<section class="py-5 bg-white">
    <div class="container" style="max-width: 72rem;">
        <div class="text-center mb-5">
            <h2 class="fw-bold text-slate-800 mb-3 fs-2">Tại Sao Chọn Trạm Voltera?</h2>
            <p class="text-slate-600 fs-5 mx-auto" style="max-width: 42rem;">
                Hệ thống trạm hiện đại với đầy đủ tiện nghi và dịch vụ chuyên nghiệp
            </p>
        </div>

        <div class="row g-4">
            <!-- Feature 1 -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="feature-card">
                    <div class="feature-icon bg-emerald-100">
                        <span class="material-icons text-emerald-600">verified</span>
                    </div>
                    <h3 class="feature-title">An Toàn</h3>
                    <p class="feature-description">Giám sát 24/7 với camera và bảo vệ</p>
                </div>
            </div>

            <!-- Feature 2 -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="feature-card">
                    <div class="feature-icon bg-blue-100">
                        <span class="material-icons text-blue-600">location_on</span>
                    </div>
                    <h3 class="feature-title">Tiện Lợi</h3>
                    <p class="feature-description">Vị trí thuận tiện, dễ tìm</p>
                </div>
            </div>

            <!-- Feature 3 -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="feature-card">
                    <div class="feature-icon bg-purple-100">
                        <span class="material-icons text-purple-600">support_agent</span>
                    </div>
                    <h3 class="feature-title">Hỗ Trợ</h3>
                    <p class="feature-description">Nhân viên nhiệt tình, chuyên nghiệp</p>
                </div>
            </div>

            <!-- Feature 4 -->
            <div class="col-12 col-md-6 col-lg-3">
                <div class="feature-card">
                    <div class="feature-icon bg-orange-100">
                        <span class="material-icons text-orange-600">cleaning_services</span>
                    </div>
                    <h3 class="feature-title">Sạch Sẽ</h3>
                    <p class="feature-description">Vệ sinh xe và trạm thường xuyên</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-5 cta-gradient">
    <div class="container" style="max-width: 48rem;">
        <div class="text-center px-3">
            <h2 class="fw-bold text-white mb-3 fs-2">Sẵn Sàng Thuê Xe?</h2>
            <p class="fs-5 text-emerald-100 mb-4">
                Tìm xe điện phù hợp tại trạm gần bạn ngay hôm nay
            </p>
            <a asp-page="/Index" class="btn bg-white text-emerald-600 fw-semibold rounded-pill px-4 py-3 hover-scale shadow-lg">
                <span class="material-icons" style="vertical-align: middle;">search</span>
                Tìm Xe Ngay
            </a>
        </div>
    </div>
</section>
